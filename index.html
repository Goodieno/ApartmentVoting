<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì•„íŒŒíŠ¸ íˆ¬í‘œ ê²°ê³¼</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  margin: 12px;
  background: linear-gradient(180deg, #f4f6f8, #eef1f5);
  text-align: center;
}

/* ================= WINNER OVERLAY ================= */
#winnerOverlay {
  position: fixed;
  inset: 0;
  background: radial-gradient(circle at center, #222 0%, #000 70%);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  overflow: hidden;
}

#winnerOverlay.hidden { display: none; }

/* Moving spotlight */
#winnerOverlay::before {
  content: "";
  position: absolute;
  width: 200%;
  height: 200%;
  background: linear-gradient(
    120deg,
    transparent 45%,
    rgba(255,255,255,0.15) 50%,
    transparent 55%
  );
  animation: spotlight 4s linear infinite;
}

@keyframes spotlight {
  from { transform: translateX(-50%) translateY(-50%) rotate(0deg); }
  to   { transform: translateX(-50%) translateY(-50%) rotate(360deg); }
}

.winnerBox {
  position: relative;
  color: white;
  padding: 44px;
  border-radius: 26px;
  background: rgba(0,0,0,0.65);
  box-shadow: 0 0 60px gold;
  animation: popIn 0.9s ease-out;
}

@keyframes popIn {
  0% { transform: scale(0.6); opacity: 0; }
  100% { transform: scale(1); opacity: 1; }
}

.trophy {
  font-size: 4.2em;
  animation: trophyBounce 1.6s ease-in-out infinite;
  text-shadow: 0 0 20px gold;
}

@keyframes trophyBounce {
  0%,100% { transform: translateY(0); }
  50% { transform: translateY(-14px); }
}

.winnerBox h1 {
  font-size: 2.2em;
  margin: 10px 0 6px;
}

.winnerBox h2 {
  font-size: 2em;
  color: gold;
  animation: shimmer 2s infinite;
}

@keyframes shimmer {
  0% { text-shadow: 0 0 6px gold; }
  50% { text-shadow: 0 0 18px gold; }
  100% { text-shadow: 0 0 6px gold; }
}

/* ================= CONFETTI ================= */
.confetti {
  position: absolute;
  width: 10px;
  height: 10px;
  animation: fall 4s linear infinite;
  opacity: 0.9;
}

@keyframes fall {
  0% { transform: translateY(-100px) rotate(0deg); }
  100% { transform: translateY(120vh) rotate(720deg); }
}

/* ================= NORMAL PAGE ================= */
h1 { font-size: 1.7em; margin-bottom: 6px; }
h2 { font-size: 1.3em; }

.panel {
  background: #fff;
  border-radius: 18px;
  padding: 20px 16px;
  max-width: 900px;
  margin: 14px auto;
  box-shadow: 0 6px 18px rgba(0,0,0,0.08);
}

/* Podium animation */
.podium div {
  font-size: 1.1em;
  margin: 6px 0;
  font-weight: bold;
  opacity: 0;
  animation: slideIn 0.6s ease-out forwards;
}

.podium div:nth-child(1) { animation-delay: 0.1s; }
.podium div:nth-child(2) { animation-delay: 0.3s; }
.podium div:nth-child(3) { animation-delay: 0.5s; }

@keyframes slideIn {
  from { transform: translateY(20px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

/* Table animation */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 14px;
  font-size: 0.9em;
}

th, td {
  border: 1px solid #ccc;
  padding: 6px;
}

tbody tr {
  animation: rowFade 0.5s ease-out forwards;
}

@keyframes rowFade {
  from { opacity: 0; transform: translateY(6px); }
  to { opacity: 1; transform: translateY(0); }
}

/* First place row highlight */
tr.winnerRow {
  background: linear-gradient(90deg, #fff7cc, #fff1a8);
  animation: pulseGold 2s infinite;
}

@keyframes pulseGold {
  0% { box-shadow: inset 0 0 0 gold; }
  50% { box-shadow: inset 0 0 12px gold; }
  100% { box-shadow: inset 0 0 0 gold; }
}
</style>
</head>

<body>

<!-- WINNER OVERLAY -->
<div id="winnerOverlay" class="hidden" onclick="this.classList.add('hidden')">
  <div class="winnerBox">
    <div class="trophy">ğŸ†</div>
    <h1>ìµœì¢… ìš°ìŠ¹</h1>
    <h2 id="winnerName"></h2>
    <p style="opacity:.75;">(í™”ë©´ì„ ëˆ„ë¥´ë©´ ë‹«í˜)</p>
  </div>
</div>

<h1>5í•™ë…„ ì•„íŒŒíŠ¸ íˆ¬í‘œ ê²°ê³¼</h1>
<p style="color:#2e7d32; font-weight:bold;">íˆ¬í‘œê°€ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤</p>
<div id="voteDate" style="margin-bottom:12px; color:#555;"></div>

<div class="panel">
  <h2>ğŸ† ìµœì¢… ìˆœìœ„</h2>
  <div class="podium" id="podium"></div>

  <table>
    <thead>
      <tr>
        <th>ë°˜</th>
        <th>í’ˆì§ˆ</th>
        <th>ë§ì¶¤ë²•</th>
        <th>ì°½ì˜ì„±</th>
        <th>ì˜ì–´</th>
        <th>í•©ê³„</th>
        <th>ë‚ ì§œ</th>
      </tr>
    </thead>
    <tbody id="resultsBody"></tbody>
  </table>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

const app = initializeApp({
  apiKey: "AIzaSyD0tDXxueqQAkEYsNGDHUcQM5TWf2FKyyk",
  databaseURL: "https://apartmentvoting-default-rtdb.firebaseio.com"
});

const db = getDatabase(app);
const resultsBody = document.getElementById("resultsBody");
const podium = document.getElementById("podium");
const voteDate = document.getElementById("voteDate");
const overlay = document.getElementById("winnerOverlay");
const winnerName = document.getElementById("winnerName");

onValue(ref(db, "votes"), snap => {
  const data = snap.val();
  if (!data) return;

  resultsBody.innerHTML = "";
  podium.innerHTML = "";

  const totals = {};
  const rows = [];
  let displayDate = null;

  Object.values(data).forEach(v => {
    if (!v.className) return;
    const sum = v.quality + v.spelling + v.creativity + v.english;
    totals[v.className] = (totals[v.className] || 0) + sum;
    rows.push({ ...v, sum });
    if (!displayDate && v.time) displayDate = v.time;
  });

  if (displayDate) {
    const d = new Date(displayDate);
    const weekday = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '][d.getDay()];
    voteDate.textContent = `íˆ¬í‘œì¼: ${weekday} ${d.getMonth()+1}.${d.getDate()}`;
  }

  const ranking = Object.entries(totals).sort((a,b)=>b[1]-a[1]);

  if (ranking.length) {
    winnerName.textContent = `${ranking[0][0]} (${ranking[0][1]}ì )`;
    overlay.classList.remove("hidden");
    spawnConfetti();
  }

  ranking.slice(0,3).forEach((r,i)=>{
    podium.innerHTML += `<div>${['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'][i]} ${r[0]} â€” ${r[1]}ì </div>`;
  });

  rows.sort((a,b)=>a.time - b.time).forEach(v => {
    const d = new Date(v.time);
    const weekday = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '][d.getDay()];
    const isWinner = v.className === ranking[0][0];
    resultsBody.innerHTML += `
      <tr class="${isWinner ? 'winnerRow' : ''}">
        <td>${v.className}</td>
        <td>${v.quality}</td>
        <td>${v.spelling}</td>
        <td>${v.creativity}</td>
        <td>${v.english}</td>
        <td><b>${v.sum}</b></td>
        <td>${weekday} ${d.getMonth()+1}.${d.getDate()}</td>
      </tr>`;
  });
});

function spawnConfetti() {
  for (let i = 0; i < 90; i++) {
    const c = document.createElement("div");
    c.className = "confetti";
    c.style.left = Math.random() * 100 + "vw";
    c.style.background = ["gold","red","cyan","lime","magenta"][i%5];
    c.style.animationDelay = Math.random() * 3 + "s";
    document.body.appendChild(c);
    setTimeout(()=>c.remove(), 6000);
  }
}
</script>

</body>
</html>  background: rgba(0,0,0,0.6);
}

.winnerBox h1 {
  font-size: 2.4em;
  margin-bottom: 10px;
  text-shadow: 0 0 12px gold;
}

.winnerBox h2 {
  font-size: 2em;
  color: gold;
}

@keyframes flashBg {
  0% { box-shadow: inset 0 0 0 rgba(255,255,255,0); }
  50% { box-shadow: inset 0 0 120px rgba(255,255,255,0.15); }
  100% { box-shadow: inset 0 0 0 rgba(255,255,255,0); }
}

/* ---------- CONFETTI ---------- */
.confetti {
  position: absolute;
  width: 10px;
  height: 10px;
  background: red;
  animation: fall 4s linear infinite;
  opacity: 0.9;
}

@keyframes fall {
  0% {
    transform: translateY(-100px) rotate(0deg);
  }
  100% {
    transform: translateY(120vh) rotate(720deg);
  }
}

/* ---------- NORMAL PAGE ---------- */
h1 { font-size: 1.7em; margin-bottom: 6px; }
h2 { font-size: 1.3em; }

.panel {
  background: #fff;
  border-radius: 18px;
  padding: 20px 16px;
  max-width: 900px;
  margin: 14px auto;
  box-shadow: 0 6px 18px rgba(0,0,0,0.08);
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 14px;
  font-size: 0.9em;
}

th, td {
  border: 1px solid #ccc;
  padding: 6px;
}

.podium div {
  font-size: 1.1em;
  margin: 6px 0;
  font-weight: bold;
}
</style>
</head>

<body>

<!-- WINNER OVERLAY -->
<div id="winnerOverlay" class="hidden" onclick="this.classList.add('hidden')">
  <div class="winnerBox">
    <h1>ğŸ† ìµœì¢… ìš°ìŠ¹!</h1>
    <h2 id="winnerName"></h2>
    <p style="opacity:.8;">(í™”ë©´ì„ ëˆ„ë¥´ë©´ ë‹«í™ë‹ˆë‹¤)</p>
  </div>
</div>

<h1>5í•™ë…„ ì•„íŒŒíŠ¸ íˆ¬í‘œ ê²°ê³¼</h1>
<p style="color:#2e7d32; font-weight:bold;">íˆ¬í‘œê°€ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤</p>
<div id="voteDate" style="margin-bottom:12px; color:#555;"></div>

<div class="panel">
  <h2>ğŸ† ìµœì¢… ìˆœìœ„</h2>
  <div class="podium" id="podium"></div>

  <table>
    <thead>
      <tr>
        <th>ë°˜</th>
        <th>í’ˆì§ˆ</th>
        <th>ë§ì¶¤ë²•</th>
        <th>ì°½ì˜ì„±</th>
        <th>ì˜ì–´</th>
        <th>í•©ê³„</th>
        <th>ë‚ ì§œ</th>
      </tr>
    </thead>
    <tbody id="resultsBody"></tbody>
  </table>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

const app = initializeApp({
  apiKey: "AIzaSyD0tDXxueqQAkEYsNGDHUcQM5TWf2FKyyk",
  databaseURL: "https://apartmentvoting-default-rtdb.firebaseio.com"
});

const db = getDatabase(app);
const resultsBody = document.getElementById("resultsBody");
const podium = document.getElementById("podium");
const voteDate = document.getElementById("voteDate");
const overlay = document.getElementById("winnerOverlay");
const winnerName = document.getElementById("winnerName");

onValue(ref(db, "votes"), snap => {
  const data = snap.val();
  if (!data) return;

  resultsBody.innerHTML = "";
  podium.innerHTML = "";

  const totals = {};
  const rows = [];
  let displayDate = null;

  Object.values(data).forEach(v => {
    if (!v.className) return;
    const sum = v.quality + v.spelling + v.creativity + v.english;
    totals[v.className] = (totals[v.className] || 0) + sum;
    rows.push({ ...v, sum });
    if (!displayDate && v.time) displayDate = v.time;
  });

  if (displayDate) {
    const d = new Date(displayDate);
    const weekday = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '][d.getDay()];
    voteDate.textContent = `íˆ¬í‘œì¼: ${weekday} ${d.getMonth()+1}.${d.getDate()}`;
  }

  const ranking = Object.entries(totals).sort((a,b)=>b[1]-a[1]);

  // ğŸ‰ SHOW WINNER PAGE
  if (ranking.length) {
    winnerName.textContent = `${ranking[0][0]} (${ranking[0][1]}ì )`;
    overlay.classList.remove("hidden");
    spawnConfetti();
  }

  ranking.slice(0,3).forEach((r,i)=>{
    podium.innerHTML += `<div>${['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'][i]} ${r[0]} â€” ${r[1]}ì </div>`;
  });

  rows.sort((a,b)=>a.time - b.time).forEach(v => {
    const d = new Date(v.time);
    const weekday = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '][d.getDay()];
    resultsBody.innerHTML += `
      <tr>
        <td>${v.className}</td>
        <td>${v.quality}</td>
        <td>${v.spelling}</td>
        <td>${v.creativity}</td>
        <td>${v.english}</td>
        <td><b>${v.sum}</b></td>
        <td>${weekday} ${d.getMonth()+1}.${d.getDate()}</td>
      </tr>`;
  });
});

function spawnConfetti() {
  for (let i = 0; i < 80; i++) {
    const c = document.createElement("div");
    c.className = "confetti";
    c.style.left = Math.random() * 100 + "vw";
    c.style.background = ["gold","red","cyan","lime","magenta"][i%5];
    c.style.animationDelay = Math.random() * 3 + "s";
    document.body.appendChild(c);
    setTimeout(()=>c.remove(), 6000);
  }
}
</script>

</body>
</html>th, td {
  border: 1px solid #ccc;
  padding: 6px;
}

.podium div {
  font-size: 1.1em;
  margin: 6px 0;
  font-weight: bold;
}
</style>
</head>

<body>

<h1>5í•™ë…„ ì•„íŒŒíŠ¸ íˆ¬í‘œ ê²°ê³¼</h1>
<p style="color:#2e7d32; font-weight:bold;">íˆ¬í‘œê°€ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤</p>
<div id="voteDate" style="margin-bottom:12px; color:#555;"></div>

<div class="panel">
  <h2>ğŸ† ìµœì¢… ìˆœìœ„</h2>
  <div class="podium" id="podium"></div>

  <table>
    <thead>
      <tr>
        <th>ë°˜</th>
        <th>í’ˆì§ˆ</th>
        <th>ë§ì¶¤ë²•</th>
        <th>ì°½ì˜ì„±</th>
        <th>ì˜ì–´</th>
        <th>í•©ê³„</th>
        <th>ë‚ ì§œ</th>
      </tr>
    </thead>
    <tbody id="resultsBody"></tbody>
  </table>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

// Firebase config
const app = initializeApp({
  apiKey: "AIzaSyD0tDXxueqQAkEYsNGDHUcQM5TWf2FKyyk",
  databaseURL: "https://apartmentvoting-default-rtdb.firebaseio.com"
});

const db = getDatabase(app);
const resultsBody = document.getElementById("resultsBody");
const podium = document.getElementById("podium");
const voteDate = document.getElementById("voteDate");

onValue(ref(db, "votes"), snap => {
  const data = snap.val();
  if (!data) {
    resultsBody.innerHTML = '<tr><td colspan="6">ê²°ê³¼ ì—†ìŒ</td></tr>';
    return;
  }

  resultsBody.innerHTML = "";
  podium.innerHTML = "";

  const totals = {};
  const rows = [];
  let displayDate = null;

  Object.values(data).forEach(v => {
    if (!v.className) return;

    const sum = v.quality + v.spelling + v.creativity + v.english;
    totals[v.className] = (totals[v.className] || 0) + sum;

    rows.push({ ...v, sum });

    if (!displayDate && v.time) displayDate = v.time;
  });

  // ë‚ ì§œ í‘œì‹œ
  if (displayDate) {
    const d = new Date(displayDate);
    const weekday = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '][d.getDay()];
    voteDate.textContent = `íˆ¬í‘œì¼: ${weekday} ${d.getMonth() + 1}.${d.getDate()}`;
  } else {
    voteDate.textContent = 'íˆ¬í‘œì¼ ì •ë³´ ì—†ìŒ';
  }

  // Podium (ì´ì  ê¸°ì¤€)
  Object.entries(totals)
    .sort((a,b)=>b[1]-a[1])
    .slice(0,3)
    .forEach((r,i)=>{
      podium.innerHTML += `<div>${['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'][i]} ${r[0]} â€” ${r[1]}ì </div>`;
    });

  // í…Œì´ë¸”: ì‹œê°„ìˆœ ì •ë ¬
  rows
    .sort((a,b)=>a.time - b.time)
    .forEach(v => {
      const d = new Date(v.time);
      const weekday = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '][d.getDay()];
      const dateText = `${weekday} ${d.getMonth()+1}.${d.getDate()}`;

      resultsBody.innerHTML += `
        <tr>
          <td>${v.className}</td>
          <td>${v.quality}</td>
          <td>${v.spelling}</td>
          <td>${v.creativity}</td>
          <td>${v.english}</td>
          <td><b>${v.sum}</b></td>
          <td>${dateText}</td>
        </tr>`;
    });
});
</script>

</body>
</html>
