<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì•„íŒŒíŠ¸ íˆ¬í‘œ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  margin: 12px;
  background: linear-gradient(180deg,#f4f6f8,#eef1f5);
  text-align: center;
}

.panel {
  background:#fff;
  border-radius:18px;
  padding:20px 16px;
  max-width:720px;
  margin:16px auto;
  box-shadow:0 6px 18px rgba(0,0,0,0.08);
}

button {
  padding:12px 16px;
  border-radius:10px;
  border:none;
  font-size:16px;
  cursor:pointer;
  background:#e0e0e0;
}

.hidden { display:none; }

#classLinks {
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:12px;
}

.score-buttons {
  display:grid;
  grid-template-columns:repeat(5,1fr);
  gap:8px;
  max-width:420px;
  margin:8px auto;
}

.score-buttons button.selected {
  background:#0078d7;
  color:#fff;
  font-weight:bold;
}

@keyframes pulse {
  0% { transform:scale(1); }
  50% { transform:scale(1.05); }
  100% { transform:scale(1); }
}
</style>
</head>

<body>

<h1>5í•™ë…„ ì•„íŒŒíŠ¸ íˆ¬í‘œ</h1>
<p style="color:#c62828;font-weight:bold;">* êµì‚¬ë‹¹ 1íšŒë§Œ íˆ¬í‘œí•´ ì£¼ì„¸ìš” *</p>

<div id="home" class="panel">
  <h2>ë°˜ ëª©ë¡</h2>
  <div id="classLinks"></div>
  <div id="countdown" style="margin-top:12px;font-weight:bold;"></div>
  <div id="totalCounter">ì´ íˆ¬í‘œ ìˆ˜: 0</div>
  <button onclick="openAdmin()">ê´€ë¦¬ì</button>
</div>

<div id="votePage" class="panel hidden">
  <h2 id="voteTitle"></h2>
  <div>í’ˆì§ˆ <div id="quality" class="score-buttons"></div></div>
  <div>ë§ì¶¤ë²• <div id="spelling" class="score-buttons"></div></div>
  <div>ì°½ì˜ì„± <div id="creativity" class="score-buttons"></div></div>
  <div>ì˜ì–´ <div id="english" class="score-buttons"></div></div>
  <button onclick="submitVote()">ì œì¶œ</button>
  <button onclick="goHome()">ì·¨ì†Œ</button>
</div>

<div id="adminPage" class="panel hidden">
  <input id="adminPass" type="password" placeholder="password">
  <button onclick="viewResults()">ê²°ê³¼</button>
  <button onclick="deleteAll()">ì „ì²´ ì‚­ì œ</button>
  <button onclick="goHome()">ë’¤ë¡œ</button>
  <div id="results" class="hidden">
    <h3>ğŸ† ê²°ê³¼</h3>
    <div id="podium"></div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

const app = initializeApp({
  apiKey: "AIzaSyD0tDXxueqQAkEYsNGDHUcQM5TWf2FKyyk",
  databaseURL: "https://apartmentvoting-default-rtdb.firebaseio.com"
});

const db = getDatabase(app);
const VOTING_END = new Date(2026,0,7,15,30);

function updateCountdown(){
  const diff = VOTING_END - new Date();
  const el = document.getElementById("countdown");

  if(diff<=0){
    el.textContent="â›” íˆ¬í‘œ ì¢…ë£Œ";
    el.style.color="red";
    return;
  }

  const h=Math.floor(diff/3600000);
  const m=Math.floor(diff%3600000/60000);
  const s=Math.floor(diff%60000/1000);

  el.textContent=`â° ${h}ì‹œê°„ ${m}ë¶„ ${s}ì´ˆ`;
  if(diff<600000) el.style.animation="pulse 1s infinite";
}

setInterval(updateCountdown,1000);
updateCountdown();

const classLinks=document.getElementById("classLinks");
for(let i=1;i<=8;i++){
  const b=document.createElement("button");
  b.textContent=`${i}ë°˜`;
  b.onclick=()=>openVotePage(`${i}ë°˜`);
  classLinks.appendChild(b);
}

let currentClass=null;
let scores={};

function makeButtons(id,key){
  const c=document.getElementById(id);
  for(let i=1;i<=5;i++){
    const b=document.createElement("button");
    b.textContent=i;
    b.onclick=()=>{
      scores[key]=i;
      [...c.children].forEach(x=>x.classList.remove("selected"));
      b.classList.add("selected");
    };
    c.appendChild(b);
  }
}

["quality","spelling","creativity","english"].forEach(x=>makeButtons(x,x));

window.openVotePage=(cls)=>{
  currentClass=cls;
  scores={};
  show("votePage");
  document.getElementById("voteTitle").textContent=cls;
};

window.submitVote=async()=>{
  if(new Date()>VOTING_END) return alert("ì¢…ë£Œë¨");
  if(Object.keys(scores).length<4) return alert("ëª¨ë‘ ì„ íƒ");
  await push(ref(db,"votes"),{className:currentClass,...scores,time:Date.now()});
  goHome();
};

window.openAdmin=()=>show("adminPage");
window.goHome=()=>show("home");

function show(id){
  ["home","votePage","adminPage"].forEach(x=>document.getElementById(x).classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}

onValue(ref(db,"votes"),snap=>{
  const d=snap.val();
  document.getElementById("totalCounter").textContent="ì´ íˆ¬í‘œ ìˆ˜: "+(d?Object.keys(d).length:0);
});
</script>

</body>
</html>
