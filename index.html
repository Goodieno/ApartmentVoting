<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì•„íŒŒíŠ¸ íˆ¬í‘œ ê²°ê³¼</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  margin: 12px;
  background: linear-gradient(180deg, #f4f6f8, #eef1f5);
  text-align: center;
}

h1 { font-size: 1.7em; margin-bottom: 6px; }
h2 { font-size: 1.3em; }

.panel {
  background: #fff;
  border-radius: 18px;
  padding: 20px 16px;
  max-width: 900px;
  margin: 14px auto;
  box-shadow: 0 6px 18px rgba(0,0,0,0.08);
}

.hidden { display: none; }

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 14px;
  font-size: 0.9em;
}

th, td {
  border: 1px solid #ccc;
  padding: 6px;
}

.podium div {
  font-size: 1.1em;
  margin: 6px 0;
  font-weight: bold;
}
</style>
</head>

<body>

<h1>5í•™ë…„ ì•„íŒŒíŠ¸ íˆ¬í‘œ ê²°ê³¼</h1>
<p style="color:#2e7d32; font-weight:bold;">íˆ¬í‘œê°€ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤</p>
<div id="voteDate" style="margin-bottom:12px; color:#555;"></div>

<div class="panel">
  <h2>ğŸ† ìµœì¢… ìˆœìœ„</h2>
  <div class="podium" id="podium"></div>

  <table>
    <thead>
      <tr>
        <th>ë°˜</th>
        <th>í’ˆì§ˆ</th>
        <th>ë§ì¶¤ë²•</th>
        <th>ì°½ì˜ì„±</th>
        <th>ì˜ì–´</th>
        <th>í•©ê³„</th>
        <th>ë‚ ì§œ</th>
      </tr>
    </thead>
    <tbody id="resultsBody"></tbody>
  </table>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

// Firebase config
const app = initializeApp({
  apiKey: "AIzaSyD0tDXxueqQAkEYsNGDHUcQM5TWf2FKyyk",
  databaseURL: "https://apartmentvoting-default-rtdb.firebaseio.com"
});

const db = getDatabase(app);
const resultsBody = document.getElementById("resultsBody");
const podium = document.getElementById("podium");
const voteDate = document.getElementById("voteDate");

onValue(ref(db, "votes"), snap => {
  const data = snap.val();
  if (!data) {
    resultsBody.innerHTML = '<tr><td colspan="6">ê²°ê³¼ ì—†ìŒ</td></tr>';
    return;
  }

  resultsBody.innerHTML = "";
  podium.innerHTML = "";

  const totals = {};
  const rows = [];
  let displayDate = null;

  Object.values(data).forEach(v => {
    if (!v.className) return;

    const sum = v.quality + v.spelling + v.creativity + v.english;
    totals[v.className] = (totals[v.className] || 0) + sum;

    rows.push({ ...v, sum });

    if (!displayDate && v.time) displayDate = v.time;
  });

  // ë‚ ì§œ í‘œì‹œ
  if (displayDate) {
    const d = new Date(displayDate);
    const weekday = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '][d.getDay()];
    voteDate.textContent = `íˆ¬í‘œì¼: ${weekday} ${d.getMonth() + 1}.${d.getDate()}`;
  } else {
    voteDate.textContent = 'íˆ¬í‘œì¼ ì •ë³´ ì—†ìŒ';
  }

  // Podium (ì´ì  ê¸°ì¤€)
  Object.entries(totals)
    .sort((a,b)=>b[1]-a[1])
    .slice(0,3)
    .forEach((r,i)=>{
      podium.innerHTML += `<div>${['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'][i]} ${r[0]} â€” ${r[1]}ì </div>`;
    });

  // í…Œì´ë¸”: ì‹œê°„ìˆœ ì •ë ¬
  rows
    .sort((a,b)=>a.time - b.time)
    .forEach(v => {
      const d = new Date(v.time);
      const weekday = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '][d.getDay()];
      const dateText = `${weekday} ${d.getMonth()+1}.${d.getDate()}`;

      resultsBody.innerHTML += `
        <tr>
          <td>${v.className}</td>
          <td>${v.quality}</td>
          <td>${v.spelling}</td>
          <td>${v.creativity}</td>
          <td>${v.english}</td>
          <td><b>${v.sum}</b></td>
          <td>${dateText}</td>
        </tr>`;
    });
});
</script>

</body>
</html>
